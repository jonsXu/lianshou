{"version":3,"sources":["../../../../../src/view/foods/components/goodslist/index.js"],"names":["name","props","data","heights","listIndex","y","computed","methods","initScroll","goodsScroll","$nextTick","judgeHeights","$refs","goods","click","probeType","on","poxY","Math","abs","round","changeMenuIndex","refresh","i","length","item1","item2","$emit","types","querySelectorAll","baseHeight","typeH","clientHeight","push","add","index1","index2","e","console","info","foods","buyNumber","$set","move","event","detail","$router","params","mounted","watch","list","datas","typeIndex","index","scrollTo"],"mappings":"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","file":"index.js","sourcesContent":["import { mapGetters, mapActions } from 'vuex'\r\nimport Bscroll from 'better-scroll' \r\nimport qs from 'qs'\r\nexport default {\r\n  name: 'GoodsList',\r\n  props:['list','typeIndex'],\r\n  data () {\r\n    return {\r\n      data:[],\r\n      heights:[0],\r\n      listIndex:0,\r\n      y:0,\r\n    }\r\n  },\r\n  computed: {\r\n      ...mapGetters([\r\n        'nameGetter',\r\n        'ctxGetter'\r\n      ]),\r\n\r\n  },\r\n  methods:{\r\n    ...mapActions([\r\n        'setName',\r\n        'setCtx' //\r\n    ]),\r\n    initScroll(){\r\n      if(!this.goodsScroll){ \r\n        this.$nextTick(() => { \r\n          this.judgeHeights()\r\n          this.goodsScroll = new Bscroll(this.$refs.goods, {\r\n            click: true,\r\n            probeType:3,//开启滚动中派发滚动事件事件\r\n          })\r\n          this.goodsScroll.on('scroll',(poxY)=>{\r\n            this.y = Math.abs(Math.round(poxY.y))\r\n            this.changeMenuIndex(this.y)\r\n          })\r\n        })\r\n      } else {\r\n        this.goodsScroll.refresh()\r\n      }\r\n      //this.judgeHeights()\r\n      \r\n    },\r\n    //改变导航列表\r\n    changeMenuIndex(y){\r\n        for(let i = 0 ;i<=this.heights.length-1;i++) {\r\n          let item1 = this.heights[i]\r\n          let item2 = this.heights[i+1]\r\n          if(this.y>=item1&& this.y<item2){\r\n            //this.index = i\r\n            this.listIndex = i\r\n            return this.$emit('change-index',this.listIndex)\r\n          }\r\n        }\r\n    },\r\n    judgeHeights(){\r\n      let types = this.$refs.goods.querySelectorAll('li.types');\r\n      let baseHeight = 0 \r\n      for(let i=0;i<types.length;i++) {\r\n        let typeH =  types[i].clientHeight\r\n        baseHeight += typeH;\r\n        this.heights.push(baseHeight)\r\n      }\r\n      \r\n    },\r\n    add(index1,index2,e){\r\n      console.info(e)\r\n      if(this.data[index1].foods[index2].buyNumber&&this.data[index1].foods[index2].buyNumber>0){\r\n        this.data[index1].foods[index2].buyNumber +=1\r\n      } else {\r\n        this.$set(this.data[index1].foods[index2],'buyNumber',1)\r\n      }\r\n      this.$emit('add',{data:this.data[index1].foods[index2],index1:index1,index2:index2});\r\n    },\r\n    move(index1,index2,event){\r\n      this.data[index1].foods[index2].buyNumber +=-1\r\n      this.$emit('remove',{data:this.data[index1].foods[index2],index1:index1,index2:index2});\r\n    },\r\n    detail(data){\r\n      this.$router.push({name:'foodDetail',params:{data:data}})\r\n    }\r\n  },\r\n  mounted(){\r\n    \r\n  },\r\n  watch:{\r\n    list(datas){\r\n      this.data = datas\r\n      if(datas!=[]&&datas.length>0){\r\n        this.initScroll()\r\n      }\r\n    },\r\n    typeIndex(index){\r\n      //this.index = index\r\n      this.goodsScroll.scrollTo(0, -this.heights[index], 300)\r\n    },\r\n  }\r\n}"]}